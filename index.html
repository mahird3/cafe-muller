<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Café Muller</title>
  <!-- Optional: Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="stylesheet" 
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap">
  <style>
    /* Basic Reset */
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f5f5;
      color: #333;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-bottom: 20px;
      font-weight: 600;
      text-align: center;
    }
    /* TABLES SECTION */
    #tables-container {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 900px;
    }
    .table-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .table-circle:hover {
      transform: scale(1.05);
    }
    .table-circle p {
      text-align: center;
      font-size: 0.8rem;
    }
    .table-number {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    /* DETAILS PANEL */
    #details-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 100%;
      max-width: 900px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      padding: 20px;
      display: none;
      margin-bottom: 20px;
    }
    #details-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    #details-header h2 {
      font-weight: 400;
    }
    .content-section {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    /* ORDER LIST */
    #order-list {
      flex: 1;
      min-width: 200px;
    }
    #order-list h3 {
      margin-bottom: 10px;
      font-weight: 400;
    }
    #order-items {
      list-style: none;
      margin-bottom: 10px;
    }
    .order-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    .remove-btn {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 2px 8px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    .remove-btn:hover {
      background: #c0392b;
    }
    #order-total {
      font-weight: 600;
      margin-top: 10px;
    }
    /* ADD ITEM PANEL */
    #add-item-panel {
      flex: 1;
      min-width: 200px;
    }
    #add-item-panel h3 {
      margin-bottom: 10px;
      font-weight: 400;
    }
    select, button {
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #fff;
      font-size: 1rem;
      cursor: pointer;
      margin-right: 10px;
    }
    button {
      background: #333;
      color: #fff;
      border: none;
    }
    button:hover {
      background: #555;
    }
    /* CLEAR TABLE BUTTON */
    #clear-table-btn {
      background: #27ae60;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    #clear-table-btn:hover {
      background: #1e8449;
    }
    /* DASHBOARD */
    #dashboard-container {
      width: 100%;
      max-width: 900px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    #dashboard-container h2 {
      margin-bottom: 10px;
      font-weight: 600;
    }
    #total-sales {
      margin-bottom: 20px;
      font-size: 1.2rem;
      font-weight: 600;
    }
    #product-sales table {
      width: 100%;
      border-collapse: collapse;
    }
    #product-sales th, #product-sales td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    #product-sales th {
      background-color: #f2f2f2;
    }
    /* MEDIA QUERIES */
    @media (max-width: 600px) {
      .content-section {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <h1>Café Muller</h1>

  <!-- TABLES (CIRCLES) -->
  <div id="tables-container">
    <!-- Dynamically created table circles -->
  </div>

  <!-- DETAILS PANEL (SHOWS WHEN A TABLE IS CLICKED) -->
  <div id="details-container">
    <div id="details-header">
      <h2 id="details-title">Table X Details</h2>
      <span id="details-time"></span>
    </div>
    <div class="content-section">
      <!-- ORDER LIST -->
      <div id="order-list">
        <h3>Current Items</h3>
        <ul id="order-items"></ul>
        <div id="order-total"></div>
      </div>
      <!-- ADD ITEM PANEL -->
      <div id="add-item-panel">
        <h3>Add Items</h3>
        <select id="item-select"></select>
        <button onclick="addItem()">Add Item</button>
      </div>
    </div>
    <!-- Clear Table Button -->
    <div style="text-align: right; margin-top: 10px;">
      <button id="clear-table-btn" onclick="clearTable()">Clear Table (Payment)</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard-container">
    <h2>Dashboard</h2>
    <div id="total-sales">Total Sales: 0.00€</div>
    <div id="product-sales">
      <h3>Sales by Product</h3>
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Count</th>
            <th>Revenue (€)</th>
          </tr>
        </thead>
        <tbody id="product-sales-body">
          <!-- Rows will be populated dynamically -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    /***************************************************************
     * DATA STRUCTURES
     ***************************************************************/
    // Menu items with numeric prices for easy sum
    const menuItems = [
      { name: 'Espresso (s)', price: 2.5 },
      { name: 'Espresso (d)', price: 3.5 },
      { name: 'Americano', price: 3.5 },
      { name: 'Café filtre', price: 3.5 },
      { name: 'Cortado', price: 4.0 },
      { name: 'Cappuccino / Latte', price: 4.5 },
      { name: 'Flat White', price: 5.0 },
      { name: 'Chai Latte', price: 5.0 },
      { name: 'Matcha Latte', price: 5.0 },
      { name: 'Golden Latte', price: 5.0 },
      { name: 'Thé / Infusion', price: 5.0 },
      { name: 'Grand Latte', price: 5.5 },
      { name: 'V60', price: 6.0 },
      { name: 'Soda', price: 3.5 },
      { name: 'Iced Latte (s)', price: 4.5 },
      { name: 'Iced Latte (d)', price: 5.0 },
      { name: 'Iced Chai', price: 5.0 },
      { name: 'Iced Matcha', price: 5.0 },
      { name: 'Cold Brew', price: 5.0 },
      { name: 'Espresso Tonic', price: 5.5 },
      { name: 'Limonade', price: 6.0 },
      { name: 'Ginger Beer', price: 6.0 },
      { name: 'Kombucha', price: 6.0 },
      { name: 'Cookie (Vegan) - Choc, Olive Oil, Fleur de sel', price: 4.0 },
      { name: 'Cookie - Chocolat, Tahini', price: 4.0 },
    ];

    // Each table: items array and firstItemTime (or null)
    const tablesData = {
      table1: { items: [], firstItemTime: null },
      table2: { items: [], firstItemTime: null },
      table3: { items: [], firstItemTime: null },
      table4: { items: [], firstItemTime: null },
      table5: { items: [], firstItemTime: null },
    };

    let selectedTable = null; // currently selected table

    // Global Sales Data
    let totalSalesAmount = 0;
    let productSales = {};
    // Initialize productSales with each product from menuItems
    menuItems.forEach(item => {
      if (!productSales[item.name]) {
        productSales[item.name] = { count: 0, revenue: 0 };
      }
    });

    /***************************************************************
     * INIT: CREATE TABLE CIRCLES & POPULATE ITEM SELECT
     ***************************************************************/
    const tablesContainer = document.getElementById('tables-container');
    const detailsContainer = document.getElementById('details-container');
    const detailsTitle = document.getElementById('details-title');
    const detailsTime = document.getElementById('details-time');
    const orderItemsList = document.getElementById('order-items');
    const orderTotal = document.getElementById('order-total');
    const itemSelect = document.getElementById('item-select');

    // Create table circles
    for (let i = 1; i <= 5; i++) {
      const tableDiv = document.createElement('div');
      tableDiv.classList.add('table-circle');
      tableDiv.id = `table${i}-circle`;

      const numberP = document.createElement('p');
      numberP.classList.add('table-number');
      numberP.textContent = `Table ${i}`;

      const costP = document.createElement('p');
      costP.id = `table${i}-cost`;
      costP.textContent = 'Total: 0.00€';

      const timeP = document.createElement('p');
      timeP.id = `table${i}-time`;
      timeP.textContent = '00:00';

      tableDiv.appendChild(numberP);
      tableDiv.appendChild(costP);
      tableDiv.appendChild(timeP);

      // Open details on click
      tableDiv.addEventListener('click', () => {
        selectedTable = `table${i}`;
        openTableDetails(selectedTable);
      });

      tablesContainer.appendChild(tableDiv);
    }

    // Populate the dropdown with menu items
    menuItems.forEach((item, index) => {
      const option = document.createElement('option');
      option.value = index;
      option.textContent = `${item.name} - ${item.price}€`;
      itemSelect.appendChild(option);
    });

    /***************************************************************
     * HELPER FUNCTIONS
     ***************************************************************/
    // Sum the cost of items in a table
    function getTableCost(tableKey) {
      const items = tablesData[tableKey].items;
      return items.reduce((sum, item) => sum + item.price, 0);
    }

    // Format elapsed time in a friendly format
    function formatTimeElapsed(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      if (hours > 0) {
        return `${hours}h ${minutes}m ${seconds}s`;
      } else {
        return `${minutes}m ${seconds}s`;
      }
    }

    // Update the UI for all table circles
    function updateTablesUI() {
      for (let i = 1; i <= 5; i++) {
        const tableKey = `table${i}`;
        const tableDiv = document.getElementById(`${tableKey}-circle`);
        const costP = document.getElementById(`${tableKey}-cost`);
        const timeP = document.getElementById(`${tableKey}-time`);

        const totalCost = getTableCost(tableKey);
        costP.textContent = `Total: ${totalCost.toFixed(2)}€`;

        // Change background based on items
        if (tablesData[tableKey].items.length > 0) {
          tableDiv.style.background = '#3498db';
          tableDiv.style.color = '#fff';
        } else {
          tableDiv.style.background = '#fff';
          tableDiv.style.color = '#333';
        }

        // Update time display
        if (tablesData[tableKey].items.length > 0) {
          const firstTime = tablesData[tableKey].firstItemTime;
          const elapsed = Date.now() - firstTime;
          timeP.textContent = formatTimeElapsed(elapsed);
        } else {
          timeP.textContent = '00:00';
        }
      }
    }

    // Update the Dashboard UI
    function updateDashboard() {
      // Update overall total sales
      const totalSalesEl = document.getElementById('total-sales');
      totalSalesEl.textContent = `Total Sales: ${totalSalesAmount.toFixed(2)}€`;

      // Update product sales table
      const productSalesBody = document.getElementById('product-sales-body');
      productSalesBody.innerHTML = ''; // Clear previous rows

      // For each product in productSales, create a table row if a sale was made
      for (const product in productSales) {
        const data = productSales[product];
        if (data.count > 0) {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${product}</td>
            <td>${data.count}</td>
            <td>${data.revenue.toFixed(2)}</td>
          `;
          productSalesBody.appendChild(tr);
        }
      }
    }

    // Open details for a selected table
    function openTableDetails(tableKey) {
      detailsContainer.style.display = 'block';
      detailsTitle.textContent = `Table ${tableKey.slice(-1)} Details`;
      renderSelectedTable(tableKey);
    }

    // Render the selected table's order in the details panel
    function renderSelectedTable(tableKey) {
      orderItemsList.innerHTML = '';
      tablesData[tableKey].items.forEach((item, index) => {
        const li = document.createElement('li');
        li.classList.add('order-item');
        li.innerHTML = `
          <span>${item.name} - ${item.price.toFixed(2)}€</span>
          <button class="remove-btn" onclick="removeItem('${tableKey}', ${index})">Remove</button>
        `;
        orderItemsList.appendChild(li);
      });
      const total = getTableCost(tableKey);
      orderTotal.textContent = `Total: ${total.toFixed(2)}€`;

      if (tablesData[tableKey].items.length > 0) {
        const firstTime = tablesData[tableKey].firstItemTime;
        const elapsed = Date.now() - firstTime;
        detailsTime.textContent = `Time: ${formatTimeElapsed(elapsed)}`;
      } else {
        detailsTime.textContent = 'No items yet';
      }
    }

    /***************************************************************
     * EVENT HANDLERS
     ***************************************************************/
    // Add an item to the selected table
    function addItem() {
      if (!selectedTable) return;
      const itemIndex = itemSelect.value;
      const selectedItem = menuItems[itemIndex];

      // Set first item time if this is the first item
      if (tablesData[selectedTable].items.length === 0) {
        tablesData[selectedTable].firstItemTime = Date.now();
      }

      tablesData[selectedTable].items.push({ 
        name: selectedItem.name, 
        price: selectedItem.price 
      });

      updateTablesUI();
      renderSelectedTable(selectedTable);
    }

    // Remove an item from the selected table
    function removeItem(tableKey, itemIndex) {
      tablesData[tableKey].items.splice(itemIndex, 1);
      if (tablesData[tableKey].items.length === 0) {
        tablesData[tableKey].firstItemTime = null;
      }
      updateTablesUI();
      renderSelectedTable(tableKey);
    }

    // Clear all items from the selected table (simulate payment)
    function clearTable() {
      if (!selectedTable) return;
      if (!confirm("Are you sure you want to clear all items for this table?")) return;
      
      // Update global sales data before clearing the table
      tablesData[selectedTable].items.forEach(item => {
        totalSalesAmount += item.price;
        productSales[item.name].count += 1;
        productSales[item.name].revenue += item.price;
      });
      
      // Clear the table
      tablesData[selectedTable].items = [];
      tablesData[selectedTable].firstItemTime = null;
      updateTablesUI();
      renderSelectedTable(selectedTable);
      updateDashboard();
    }

    // Update tables UI every second (for elapsed time)
    setInterval(updateTablesUI, 1000);
  </script>
</body>
</html>
